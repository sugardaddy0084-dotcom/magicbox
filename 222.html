<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®¶åº­ç‰©å“ç®¡ç†ç³»ç»Ÿ Pro</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        /* è¾“å…¥åŒºåŸŸæ ·å¼ */
        .input-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 14px;
            color: #555;
        }

        input[type="text"], 
        input[type="number"], 
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 14px;
        }

        /* è¾…åŠ©æœç´¢æŒ‰é’®ç»„ */
        .input-group {
            display: flex;
            gap: 5px;
        }

        .helper-btn {
            padding: 0 10px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            color: #666;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            white-space: nowrap;
            transition: all 0.2s;
        }

        .helper-btn:hover {
            background-color: #e2e6ea;
            color: #333;
        }

        .helper-btn.taobao { color: #ff5000; border-color: #ffdbcc; }
        .helper-btn.jd { color: #e4393c; border-color: #fad1d1; }
        .helper-btn.douban { color: #007722; border-color: #ccebd4; }

        /* ç‰¹æ®ŠåŒºåŸŸæ˜¾ç¤ºæ§åˆ¶ */
        .hidden {
            display: none;
        }

        button.add-btn {
            background-color: #1890ff;
            color: white;
            border: none;
            padding: 12px 20px;
            width: 100%;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button.add-btn:hover {
            background-color: #096dd9;
        }

        /* åˆ—è¡¨åŒºåŸŸæ ·å¼ */
        .item-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
        }

        .item-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
            transition: transform 0.2s;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12);
        }

        /* ç±»åˆ«æ ‡ç­¾ */
        .category-tag {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: white;
            font-weight: bold;
            z-index: 2;
            text-shadow: 0 1px 2px rgba(0,0,0,0.3);
        }

        .cat-item { background-color: #722ed1; } /* ç´«è‰²-ç‰©å“ */
        .cat-toy { background-color: #faad14; }  /* é»„è‰²-ç©å…· */
        .cat-book { background-color: #52c41a; } /* ç»¿è‰²-å›¾ä¹¦ */

        .img-container {
            width: 100%;
            height: 160px;
            background-color: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .item-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .card-content {
            padding: 15px;
            flex-grow: 1;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 5px;
        }

        .item-name {
            font-size: 16px;
            font-weight: bold;
            margin: 0;
            line-height: 1.4;
        }

        .douban-score {
            font-size: 12px;
            color: #007722;
            background: #eafff0;
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
        }

        .item-desc {
            font-size: 13px;
            color: #8c8c8c;
            margin-bottom: 10px;
            height: 38px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        .item-price {
            color: #ff4d4f;
            font-weight: bold;
            font-size: 18px;
        }
        
        .price-label {
            font-size: 12px;
            color: #999;
            font-weight: normal;
        }

        .card-actions {
            padding: 10px 15px;
            border-top: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        /* çŠ¶æ€æ ·å¼ */
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        .status-available { background-color: #f6ffed; color: #52c41a; border: 1px solid #b7eb8f; }
        .status-borrowed { background-color: #fff1f0; color: #cf1322; border: 1px solid #ffa39e; }

        button.action-btn {
            border: 1px solid #d9d9d9;
            background: white;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        
        button.action-btn:hover { color: #1890ff; border-color: #1890ff; }
        button.delete-btn:hover { color: #ff4d4f; border-color: #ff4d4f; }

    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ“¦ å®¶åº­ç‰©å“ç®¡ç† Pro</h1>

    <div class="input-card">
        
        <div class="form-row">
            <div class="form-group" style="flex: 0 0 100px;">
                <label>åˆ†ç±»:</label>
                <select id="itemCategory" onchange="handleCategoryChange()">
                    <option value="item">ç‰©å“</option>
                    <option value="toy">ç©å…·</option>
                    <option value="book">å›¾ä¹¦</option>
                </select>
            </div>
            <div class="form-group">
                <label>åç§°:</label>
                <div class="input-group">
                    <input type="text" id="itemName" placeholder="è¾“å…¥ç‰©å“åç§°...">
                </div>
            </div>
        </div>

        <div id="bookFields" class="form-group hidden">
            <label>è±†ç“£è¯„åˆ†:</label>
            <div class="input-group">
                <input type="number" id="doubanScore" step="0.1" max="10" placeholder="ä¾‹å¦‚: 8.5">
                <button class="helper-btn douban" onclick="searchOnline('douban')">å»è±†ç“£çœ‹åˆ† â†—</button>
            </div>
        </div>

        <div class="form-group">
            <label>ç…§ç‰‡:</label>
            <input type="file" id="itemImage" accept="image/*">
        </div>

        <div class="form-group">
            <label>ä»·æ ¼ (å…ƒ):</label>
            <div class="input-group">
                <input type="number" id="itemPrice" placeholder="0">
                <button class="helper-btn taobao" onclick="searchOnline('taobao')">æŸ¥æ·˜å® â†—</button>
                <button class="helper-btn jd" onclick="searchOnline('jd')">æŸ¥äº¬ä¸œ â†—</button>
            </div>
        </div>

        <div class="form-group">
            <label>ç®€ä»‹/å¤‡æ³¨:</label>
            <textarea id="itemDesc" rows="2" placeholder="å¡«å†™æ›´å¤šç»†èŠ‚..."></textarea>
        </div>

        <button class="add-btn" onclick="addItem()">ç¡®è®¤å…¥åº“</button>
    </div>

    <div style="margin-bottom: 15px; color: #666; font-size: 14px;">
        å½“å‰åº“å­˜ï¼š<span id="totalCount">0</span> ä»¶
    </div>
    
    <div id="itemList" class="item-list">
        </div>
</div>

<script>
    // é¡µé¢åŠ è½½
    document.addEventListener('DOMContentLoaded', loadItems);

    // ç›‘å¬åˆ†ç±»å˜åŒ–ï¼Œæ§åˆ¶è±†ç“£è¯„åˆ†æ æ˜¾ç¤º
    function handleCategoryChange() {
        const category = document.getElementById('itemCategory').value;
        const bookFields = document.getElementById('bookFields');
        if (category === 'book') {
            bookFields.classList.remove('hidden');
        } else {
            bookFields.classList.add('hidden');
        }
    }

    // è¾…åŠ©æœç´¢åŠŸèƒ½ (è§£å†³äº†æ— æ³•ç›´æ¥APIè·å–çš„é—®é¢˜)
    function searchOnline(platform) {
        const name = document.getElementById('itemName').value;
        if (!name) {
            alert("è¯·å…ˆè¾“å…¥åç§°å†æœç´¢ï¼");
            return;
        }

        let url = "";
        if (platform === 'taobao') {
            url = "https://s.taobao.com/search?q=" + encodeURIComponent(name);
        } else if (platform === 'jd') {
            url = "https://search.jd.com/Search?keyword=" + encodeURIComponent(name);
        } else if (platform === 'douban') {
            url = "https://search.douban.com/book/subject_search?search_text=" + encodeURIComponent(name);
        }
        
        window.open(url, '_blank');
    }

    // æ·»åŠ ç‰©å“é€»è¾‘
    function addItem() {
        const category = document.getElementById('itemCategory').value;
        const name = document.getElementById('itemName').value;
        const desc = document.getElementById('itemDesc').value;
        const price = document.getElementById('itemPrice').value;
        const doubanScore = document.getElementById('doubanScore').value;
        const imageInput = document.getElementById('itemImage');

        if (!name) {
            alert("è¯·è¾“å…¥ç‰©å“åç§°ï¼");
            return;
        }

        if (imageInput.files && imageInput.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                saveItemToStorage(category, name, desc, price, doubanScore, e.target.result);
            };
            reader.readAsDataURL(imageInput.files[0]);
        } else {
            saveItemToStorage(category, name, desc, price, doubanScore, null);
        }
    }

    // ä¿å­˜æ•°æ®
    function saveItemToStorage(category, name, desc, price, doubanScore, imageData) {
        const newItem = {
            id: Date.now(),
            category: category,
            name: name,
            desc: desc,
            price: price,
            doubanScore: category === 'book' ? doubanScore : null, // åªæœ‰ä¹¦æ‰å­˜åˆ†
            image: imageData,
            isBorrowed: false
        };

        let items = JSON.parse(localStorage.getItem('inventoryProData')) || [];
        items.push(newItem);
        
        try {
            localStorage.setItem('inventoryProData', JSON.stringify(items));
            resetForm();
            loadItems();
        } catch (e) {
            alert("å­˜å‚¨å¤±è´¥ï¼å›¾ç‰‡å¯èƒ½è¿‡å¤§ã€‚");
        }
    }

    // åŠ è½½åˆ—è¡¨
    function loadItems() {
        const listContainer = document.getElementById('itemList');
        listContainer.innerHTML = '';
        
        let items = JSON.parse(localStorage.getItem('inventoryProData')) || [];
        document.getElementById('totalCount').innerText = items.length;

        items.reverse().forEach(item => {
            const card = document.createElement('div');
            card.className = 'item-card';

            // åˆ†ç±»æ ‡ç­¾é€»è¾‘
            let catLabel = "ç‰©å“";
            let catClass = "cat-item";
            if(item.category === 'toy') { catLabel = "ç©å…·"; catClass = "cat-toy"; }
            if(item.category === 'book') { catLabel = "å›¾ä¹¦"; catClass = "cat-book"; }

            // çŠ¶æ€é€»è¾‘
            const statusClass = item.isBorrowed ? 'status-borrowed' : 'status-available';
            const statusText = item.isBorrowed ? 'å·²å€Ÿå‡º' : 'åœ¨åº“';
            const btnText = item.isBorrowed ? 'å½’è¿˜' : 'å€Ÿå‡º';
            
            // å›¾ç‰‡å ä½
            const imgHtml = item.image 
                ? `<img src="${item.image}" class="item-img" alt="${item.name}">` 
                : `<span style="color:#ccc">æ— å›¾</span>`;

            // è±†ç“£åˆ†æ•°æ˜¾ç¤ºé€»è¾‘
            const doubanHtml = (item.category === 'book' && item.doubanScore) 
                ? `<span class="douban-score">è±†ç“£ ${item.doubanScore}</span>` 
                : '';

            card.innerHTML = `
                <div class="category-tag ${catClass}">${catLabel}</div>
                <div class="img-container">${imgHtml}</div>
                
                <div class="card-content">
                    <div class="card-header">
                        <h4 class="item-name">${item.name}</h4>
                        ${doubanHtml}
                    </div>
                    
                    <div class="item-desc">${item.desc || 'æš‚æ— æè¿°'}</div>
                    
                    <div class="item-price">
                        <span class="price-label">Â¥</span> ${item.price || '0'}
                    </div>
                </div>

                <div class="card-actions">
                    <span class="status-badge ${statusClass}">${statusText}</span>
                    <div>
                        <button class="action-btn" onclick="toggleStatus(${item.id})">${btnText}</button>
                        <button class="action-btn delete-btn" onclick="deleteItem(${item.id})">åˆ é™¤</button>
                    </div>
                </div>
            `;
            listContainer.appendChild(card);
        });
    }

    function toggleStatus(id) {
        let items = JSON.parse(localStorage.getItem('inventoryProData')) || [];
        const index = items.findIndex(item => item.id === id);
        if (index !== -1) {
            items[index].isBorrowed = !items[index].isBorrowed;
            localStorage.setItem('inventoryProData', JSON.stringify(items));
            loadItems();
        }
    }

    function deleteItem(id) {
        if(confirm("ç¡®å®šåˆ é™¤å—ï¼Ÿ")) {
            let items = JSON.parse(localStorage.getItem('inventoryProData')) || [];
            items = items.filter(item => item.id !== id);
            localStorage.setItem('inventoryProData', JSON.stringify(items));
            loadItems();
        }
    }

    function resetForm() {
        document.getElementById('itemName').value = '';
        document.getElementById('itemDesc').value = '';
        document.getElementById('itemPrice').value = '';
        document.getElementById('doubanScore').value = '';